(define (batch-convert pattern)
    (let* ((filelist (cadr (file-glob pattern 1))))
        (while (not (null? filelist))
            (let* ((filename (car filelist))
                   (image (car (gimp-file-load RUN-NONINTERACTIVE filename filename)))
                   (drawable (car (gimp-image-get-active-layer image))))
                (gimp-selection-all image)
                (gimp-image-convert-rgb image)
                (plug-in-colors-channel-mixer RUN-NONINTERACTIVE
                                              image drawable FALSE
                                              1 0 0 0 0 1 0 1 0)
                (gimp-image-convert-indexed image 0 0 256 0 0 "")
                (gimp-file-save RUN-NONINTERACTIVE image drawable filename filename)
                (set! filelist (cdr filelist))))))
(batch-convert "*.gif")

